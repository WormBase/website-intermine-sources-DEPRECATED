#!/bin/sh

export INIT=/software/noarch/local/init
. $INIT/bash/common.bashrc

LOGFILE="/home/interminedoc/logs/build-api-doc-`date +%Y-%m-%d`.log"

(cd ~/svn/trunk
svn up

cd ~/svn/trunk/bio/test-all/dbmodel
ant clean-all
ant build-db

cd ~/svn/trunk/imbuild/javadoc
ant clean
ant
chmod -R a+rX build/javadoc/
if test "`find build/javadoc | wc -l`" -gt "1000" ; then
    rsync -avc --delete build/javadoc/ flymine@www.flymine.org:/var/www/html/api/
else
    echo "Error with API documentation - see log file $LOGFILE for details" | mail -s "API Documentation failed" interminedoc@flymine.org
fi
) >>$LOGFILE 2>&1
