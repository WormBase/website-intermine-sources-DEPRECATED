IMBedding=(function(){var b=null;var m={};var a=10;var k={from:"genomic"};var l="#placeholder";var t="/service/template/results";var s="/service/query/results";var d="/service/templates";var j=function(x){return((x%2==0)?"imbedded-column-even":"imbedded-column-odd")};var h=function(x){return((x%2==0)?"imbedded-row-even":"imbedded-row-odd")};var u={additionText:"Load [x] more rows",afterBuildTable:function(x){},afterTableUpdate:function(y,x){},allRowsText:"Show remaining rows",collapseHelpText:"hide table",countText:"[x] rows",defaultQueryName:"Query Results",emptyCellText:"[NONE]",expandHelpText:"show table",exportCSVText:"Export as CSV file",exportTSVText:"Export as TSV file",mineLinkText:"View in Mine",nextText:"Next",onTitleClick:"collapse",openOnLoad:false,previousText:"Previous",queryTitleText:null,resultsDescriptionText:null,showAdditionsLink:true,showAllCeiling:75,showAllLink:true,showCount:true,showExportLinks:true,showMineLink:true,throbberSrc:"images/throbber.gif",titleHoverCursor:"pointer"};var e=function(z,y){if(z.match(/^(http|https|ftp):\/\//)){return z}var x;if(y&&"baseUrl" in y){x=y.baseUrl}else{x=b}if((!x.match(/\/$/))&&(!z.match(/^\//))){x+="/"}return x+z};var r=function(z,C,B){$("<div></div>").html(B).attr("id","imtooltip").addClass("imbedded-table-tooltip").appendTo("body").css({position:"absolute",display:"none",top:C+10,left:z+10}).fadeIn(200);var A=document.getElementById("imtooltip")};var c=function(x,y){this._constructor=function(C,B){var H=this;this.options=jQuery.extend({},u,B);this.uid=new Date().getTime()+"-"+Math.floor(Math.random()*1001);this.uid.replace(/\s+/g,"");this.start=C.start;this.lastRow=C.size;this.size=C.size;this.pageSize=C.size;this.additionSize=C.size;this.pagePath=C.current;this.isFilledIn=false;this.count=null;this.container=jQuery('<div id="imbedded-table-container-'+this.uid+'" class="imbedded-table-container"></div>');this.titlebox=jQuery('<div id="imbedded-table-titlebox-'+this.uid+'" class="imbedded-table-titlebox"></div>');var A=this.options.queryTitleText||C.title||this.options.defaultQueryName;this.title=jQuery('<a id="imbedded-table-title-'+this.uid+'" class="imbedded-table-title">'+A+"</a>");this.expandHelp=jQuery('<span id="imbedded-table-expand-help-'+this.uid+'" class="imbedded-table-expand-help">'+this.options.expandHelpText+"</span>");this.countDisplayer=jQuery('<span id="imbedded-count-displayer-'+this.uid+'" class="imbedded-count-displayer"></span>');this.nextUrl=this.getNextUrl();this.nextLink=jQuery('<a id="imbedded-nextlink-'+this.uid+'" class="imbedded-pagelink imbedded-next">'+this.options.nextText+"</a>").mouseover(function(){jQuery(this).css({cursor:"pointer"})}).click(function(){$.jsonp({url:H.nextUrl,callbackParameter:"callback",success:function(I){H.changePage(I)}})});this.prevLink=jQuery('<a id="imbedded-prevlink-'+this.uid+'" class="imbedded-pagelink imbedded-prev">'+this.options.previousText+"</a>").mouseover(function(){jQuery(this).css({cursor:"pointer"})});this.prevLink.click(function(){$.jsonp({url:H.prevUrl,callbackParameter:"callback",success:function(I){H.changePage(I)}})});this.table=jQuery('<table style="display: none;" id="imbedded-table-'+this.uid+'" class="imbedded-table"></table>');this.colHeaderRow=jQuery('<tr class="imbedded-table-row imbedded-column-header-row"></tr>');this.colHeaderRow.append('<td class="imbedded-cell imbedded-column-header"></td>');for(var D=0;D<C.views.length;D++){var G=document.createElement("td");G.setAttribute("class","imbedded-cell imbedded-column-header");G.innerHTML=C.columnHeaders[D];this.colHeaderRow.append(G)}this.csvLink=jQuery('<a id="imbedded-csvlink-'+this.uid+'" class="imbedded-exportlink">'+this.options.exportCSVText+"</a>").attr("href",this.localiseUrl(C.csv_url));this.tsvLink=jQuery('<a id="imbedded-tsvlink-'+this.uid+'" class="imbedded-exportlink">'+this.options.exportTSVText+"</a>").attr("href",this.localiseUrl(C.tsv_url));this.mineLink=jQuery('<a id="imbedded-mineresultslink-'+this.uid+'" class="imbedded-exportlink imbedded-mineresultslink">'+this.options.mineLinkText+"</a>").attr("href",this.localiseUrl(C.mineResultsLink));var F=this.options.additionText.replace("[x]"," "+C.size+" ");this.additionLink=jQuery('<a id="imbedded-adder-'+this.uid+'" class="imbedded-addition-link imbedded-pagelink">'+F+"</a>").mouseover(function(){jQuery(this).css({cursor:"pointer"})}).click(function(){H.loadMoreRows()});this.showAllLink=jQuery('<a id="imbedded-showall-'+this.uid+'" class="imbedded-showall-link imbedded-pagelink">'+this.options.allRowsText+"</a>").mouseover(function(){jQuery(this).css({cursor:"pointer"})}).click(function(){H.loadMoreRows(true)});jQuery().add(this.csvLink).add(this.tsvLink).add(this.mineLink).attr({target:"_blank"});this.morePagers=jQuery().add(this.nextLink).add(this.showAllLink).add(this.additionLink);this.pagers=jQuery().add(this.prevLink).add(this.morePagers);$.jsonp({url:this.localiseUrl(C.count),success:function(J){if(H.options.showCount){var I=H.options.countText.replace("[x]",J.count);H.countDisplayer.text("("+I+")")}H.count=J.count;H.updateVisibilityOfPagers()},callbackParameter:"callback"});if(C.start<=0){this.prevLink.hide()}if(!this.options.openOnLoad){jQuery().add(this.prevLink).add(this.nextLink).add(this.csvLink).add(this.tsvLink).add(this.mineLink).hide()}if(this.options.showCount){this.title.append(this.countDisplayer)}this.titlebox.append(this.title);this.container.append(this.titlebox).append(this.nextLink).append(this.prevLink).append(this.table);if(this.options.showExportLinks){this.container.append(this.csvLink).append(this.tsvLink)}if(this.options.showMineLink&&this.options.onTitleClick!="mine"){this.container.append(this.mineLink)}if(this.options.showAdditionsLink){this.container.append(this.additionLink)}if(this.options.showAllLink){this.container.append(this.showAllLink)}if(this.options.onTitleClick=="collapse"){this.title.append(this.expandHelp);this.title.click(function(){H.resizeTable()}).mouseover(function(){jQuery(this).css({cursor:"pointer"})})}else{if(this.options.onTitleClick=="mine"){this.title.attr({href:this.localiseUrl(C.mineResultsLink),target:"_blank"})}else{if(this.options.onTitleClick instanceof Function){this.title.click(this.options.onTitleClick).mouseover(function(){jQuery(this).css({cursor:H.options.titleHoverCursor})})}}}var z=this.options.resultsDescriptionText||C.description;this.titlebox.hover(function(I){r(I.pageX,I.pageY,z)},function(I){jQuery(".imbedded-table-tooltip").remove()});if(this.options.openOnLoad){this.resizeTable()}else{var E=document.createElement("img");E.src=this.options.throbberSrc;this.table.append(E)}};this.changePage=function(A,z){this.fillInTable(A,z);this.updateVisibilityOfPagers();this.fitContainerToTable()};this.toggleExpandHelpText=function(){if(this.expandHelp.text()===this.options.expandHelpText){this.expandHelp.text(this.options.collapseHelpText)}else{this.expandHelp.text(this.options.expandHelpText)}};this.resizeTable=function(){var A=this;var B=function(){A.toggleExpandHelpText();A.csvLink.toggle();A.tsvLink.toggle();A.mineLink.toggle();A.table.fadeToggle("slow",function(){A.fitContainerToTable();A.updateVisibilityOfPagers()})};var z=this.localiseUrl(this.getPageUrl());if(!this.isFilledIn){this.container.css({cursor:"wait"});$.jsonp({url:z,success:function(C){A.fillInTable(C);B();A.container.css({cursor:"default"})},callbackParameter:"callback"})}else{B()}};this.updateVisibilityOfPagers=function(){if(!this.table.is(":visible")){this.hidePagers();return}this.nextUrl=this.getNextUrl();this.prevUrl=this.getPrevUrl();if(this.start>0){this.prevLink.show()}else{this.prevLink.hide()}if(this.lastRow>=this.count){this.morePagers.hide()}else{this.morePagers.show()}if(this.count>this.options.showAllCeiling){this.showAllLink.hide()}};this.hidePagers=function(){this.pagers.hide()};this.loadMoreRows=function(D){var C=this;var B=this.additionSize;var z=true;var A=this.getNextUrl(B,D);$.jsonp({url:A,success:function(E){C.size+=B;C.changePage(E,z)},callbackParameter:"callback"})};this.containerNeedsExpanding=function(){return this.table.attr("offsetWidth")>=this.container.attr("offsetWidth")};this.expandContainer=function(){if(!this.defaultContainerwidth){this.defaultContainerwidth=this.container.attr("offsetWidth")+"px"}this.container.css({width:(this.table.attr("offsetWidth")+1)+"px"})};this.tableIsHidden=function(){return this.table.attr("offsetWidth")==0};this.returnContainerToOriginalSize=function(){if(this.defaultContainerwidth){this.container.css({width:this.defaultContainerwidth})}};this.fitContainerToTable=function(){if(this.containerNeedsExpanding()){this.expandContainer()}else{if(this.tableIsHidden()){this.returnContainerToOriginalSize()}}};this.getPageUrl=function(z){z=z||this.size;return this.pagePath+"&size="+z};this.getNextUrl=function(B,A){B=B||this.size;var D=this.start+B;var C=(this.count!=null)?Math.min(this.count,D):D;C=Math.max(this.lastRow,C);var E=A?this.pagePath:this.getPageUrl(B);var z=this.localiseUrl(E)+"&start="+C;return z};this.getPrevUrl=function(A){A=A||this.size;var B=Math.max(0,(this.start-A));var C=this.getPageUrl(A);var z=this.localiseUrl(C)+"&start="+B;return z};this.localiseUrl=function(z){return e(z,this.options)};this.fillInTable=function(H,z){if(!z){this.table.children("tbody").detach();this.table.append(this.colHeaderRow)}this.table.children("img").detach();var K=H.results.length;for(var B=0;B<K;B++){var D=B+1+parseInt(H.start);var F=document.createElement("tr");F.setAttribute("class","imbedded-table-row imbedded-data-row "+h(D-1));var C=document.createElement("td");C.setAttribute("class","imbedded-cell "+j(0));C.innerHTML=D;F.appendChild(C);var J=H.results[B].length;for(var A=0;A<J;A++){var I=H.results[B][A];var E=document.createElement("td");E.setAttribute("class","imbedded-cell "+j(A));if(I.value){var G=document.createElement("a");G.target="_blank";if(I.url){G.href=this.localiseUrl(I.url)}G.innerHTML=I.value;E.appendChild(G)}else{E.innerHTML=this.options.emptyCellText;jQuery(E).addClass("imbedded-null")}F.appendChild(E)}this.table.append(F)}if(!z){this.start=H.start}this.lastRow=K+H.start;this.isFilledIn=true;if(this.options.afterTableUpdate){this.options.afterTableUpdate(this.table,H)}IMBedding.afterTableUpdate(this.table,H)};this._constructor(x,y)};var g=function(y,A,z){var x=new c(y,z);m[x.uid]=x;jQuery(A).empty().append(x.container);if(x.options.afterBuildTable){x.options.afterBuildTable(x)}IMBedding.afterBuildTable(x)};var i=function(y,x){if(y instanceof Function){return y}else{return function(z){g(z,y,x)}}};var p=function(x,y){if(y=="error"){alert("Something was wrong with your query - please edit it")}else{alert(y)}};var o=function(x,y){x+="&format=jsonptable";return v(x,{},y)};var v=function(y,z,A,x){var B=i(A,x);if(!z.format){z.format="jsonptable"}if(!z.size&&z.format=="jsonptable"){z.size=a}$.jsonp({url:y,data:z,success:B,callbackParameter:"callback",error:p})};var n=function(B){var y="";for(var z=0;z<B.length;z++){var x=B[z];var A="<constraint ";for(attr in x){A+=attr+'="'+f(x[attr])+'" '}A+="/>";y+=A}return y};var q=function(z){if(typeof(z)=="string"){return z}else{if(z instanceof Object){var y=jQuery.extend({},k,z);var C='<query model="';if("model" in y){C+=y.model}else{if("from" in y){C+=y.from}else{throw ("No model in query")}}C+='" view="';if("view" in y){C+=y.view.join(" ")}else{if("select" in y){C+=y.select.join(" ")}else{throw ("No view in query")}}C+='" ';if("constraintLogic" in y){C+='constraintLogic="'+y.constraintLogic+'" '}if("sortOrder" in y){C+='sortOrder="'+y.sortOrder+'" '}C+=">";if("joins" in y){for(var x=0;x<y.joins.length;x++){var B=y.joins[x];var A="<join ";for(attr in B){A+=(attr+'="'+B[attr]+'" ')}A+="/>";C+=A}}if("where" in y){C+=n(y.where)}if("constraints" in y){C+=n(y.constraints)}C+="</query>";return C}else{throw"Sorry - this only takes strings or objects"}}};var w={"<":"&lt;",">":"&gt;","<=":"&lt;=",">=":"&gt;="};var f=function(x){if(x in w){return w[x]}else{return x}};return{getTables:function(){return m},getTable:function(x){return m[x]},setErrorHandler:function(x){p=x},afterTableUpdate:function(x,y){},afterBuildTable:function(x){},makeQueryXML:q,setDefaultQuery:function(x){k=x;return k},setDefaultOptions:function(x){jQuery.extend(u,x);return u},setBaseUrl:function(x){b=x;return b},getBaseUrl:function(){return b},loadTemplate:function(z,A,y){if("baseUrl" in z){b=z.baseUrl}var x=e(t,y);return v(x,z,A,y)},loadQuery:function(A,z,B,y){z.query=q(A);var x=e(s,y);return v(x,z,B,y)}}})();